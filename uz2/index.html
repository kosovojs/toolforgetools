<!DOCTYPE html>
<html>
<head>
<title>Typo check</title>
<meta charset="utf-8" />
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div id="list"></div>
<script>
show_data();

function show_data() {
	$.ajax({
			type: "get",
			url: "api.php",
			dataType:"json",
			//data: {'action':'main','last_id':lastid,'type1':'next'},
		})
		.done(function (response) {
			var finalmas1 = [];

			for (var i = 0; i < response.length; i++) {
				var thisitem = response[i];
				finalmas1.push(one_item(thisitem.title,thisitem.saturs,thisitem.labojuma_id));
			}
			
		$('#list').html(finalmas1.join('\n'));
		
	}).fail(function (jqXHR, textStatus) {
		console.log(textStatus);
	});
}

function replaceAll(str, find, replace) {
    return str.replace(new RegExp(find, 'g'), replace);
}

//https://stackoverflow.com/questions/5499078/fastest-method-to-escape-html-tags-as-html-entities
String.prototype.escape = function() {
    var tagsToReplace = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;'
    };
    return this.replace(/[&<>]/g, function(tag) {
        return tagsToReplace[tag] || tag;
    });
};

function create_lv_link(href,label) {
	href = encodeURI(href);
	return '<a target="_blank" href="https://uz.wikipedia.org/wiki/'+replaceAll(href, ' ', '_')+'">'+replaceAll(label, '_', ' ')+'</a>'
}

function create_edit_link(href) {
	href = encodeURI(href);
	return '<a target="_blank" href="https://uz.wikipedia.org/w/index.php?title='+replaceAll(href, ' ', '_')+'"&action=edit>edit</a>'
}

function one_item(title,saturs,lab_id) {
	return `<div class="section"><span class="title">`+create_lv_link(title,title)+` <small>(`+create_edit_link(title)+`)</small></span>
<br>
<table>`+saturs+`</table>
</div>`
}
</script>
</body>
</html>